# PRD: Auth (MVP)

## 1) 목표
- 게스트/한의사/업체/관리자 역할을 기반으로 기본 인증 흐름을 제공한다.
- “의료계의 크몽” MVP에서 필요한 **로그인 상태/역할 가드/세션 유지**를 안정화한다.

## 2) 범위
### MVP 포함
- 이메일/비밀번호 회원가입/로그인/로그아웃
- 역할(Role) 선택 및 프로필 생성(doctor/vendor)
- 세션 유지(SSR/CSR 모두) + 페이지/라우트 권한 가드
- `GET /api/me`로 현재 사용자+역할+인증 상태 조회

### MVP 제외(P1+)
- 소셜 로그인(네이버/카카오/구글)
- 휴대폰 본인인증(PASS)
- 계정찾기(아이디/비밀번호)
- 2FA

## 3) 사용자/역할
- `guest`: 비로그인
- `doctor`: 한의사(면허 인증 대상)
- `vendor`: 업체(사업자 인증 대상)
- `admin`: 운영자(승인/제재/카테고리 관리)

원칙:
- `role`은 “UI 노출/권한 가드”의 기준이며, DB 접근은 최종적으로 RLS로 보호한다.

## 4) 주요 사용자 스토리
- 게스트로 사이트를 둘러보다가 회원가입/로그인 한다.
- 한의사로 가입하고 면허 인증을 제출한다(검수 전까지 일부 기능 제한).
- 업체로 가입하고 사업자 인증을 제출한다(검수 전까지 일부 기능 제한).
- 관리자는 인증 신청을 승인/반려하고, 그 결과를 조회할 수 있다.

## 5) UX/플로우(요약)
1. 회원가입 화면에서 “한의사/업체” 역할을 선택
2. 이메일/비밀번호로 계정 생성
3. 프로필 입력 + 인증 서류 업로드(프로필/인증 PRD 참고)
4. 승인 전: 탐색/프로필/인증 제출만 가능
   - doctor: 업체 탐색/찜 가능, **리드 생성/리뷰 작성 불가**
   - vendor: 파트너 센터에서 프로필/서류 제출 가능, **공개 노출/리드 수신 불가**
5. 승인 후: 전체 기능 사용

## 6) API(BFF) 초안
- `POST /api/auth/signup`
- `POST /api/auth/login`
- `POST /api/auth/logout`
- `GET /api/me`

주의:
- 프론트는 Supabase(DB) 직접 호출 금지. 인증 상태/역할은 BFF가 제공한다.
- 단, Supabase Auth SDK(`supabase.auth.*`)는 허용(세션 토큰/쿠키 등).

## 7) 데이터 모델(초안)
Supabase Auth:
- `auth.users`

App tables(초안):
- `profiles`
  - `id`(uuid, auth.users.id)
  - `role`(enum: `doctor|vendor|admin`)
  - `name`, `phone`, `email`(정규화), `created_at`
  - `status`(enum: `active|inactive|banned`)

## 8) RLS 정책(요약)
- `profiles`: 본인 row만 select/update 가능
- `admin` role은 운영 범위 내 조회 가능(정책/가드 설계 필요)

## 9) 오픈 이슈(결정 필요)
- admin role 부여 방식(수동/스크립트/별도 어드민 UI)
- 세션 방식(쿠키 기반 SSR 세션 vs 토큰) 및 배포 환경

## 10) 완료 기준(AC)
- 로그인/로그아웃/세션 유지가 브라우저 새로고침/SSR에서도 안정적으로 동작
- 역할별로 접근 가능한 화면/API가 일관되게 차단/허용
