# Medihub 수익화 모델 PRD

> 본 문서는 Medihub 플랫폼의 전체 수익화 모델을 정의한다.
> 공통 기반(크레딧/결제)과 4가지 과금 모델(CPA, CPL, 비딩, 쇼핑몰)을 포함한다.

## 1. 배경 및 문제 정의

현재 Medihub 플랫폼은 의사-업체 간 리드(문의) 생성이 무료로 운영되고 있다. 플랫폼의 지속 가능한 성장을 위해 다음 문제를 해결해야 한다:

- 업체에게 가치 있는 리드를 제공하면서 적절한 수익 모델 필요
- 업종별 특성에 맞는 차별화된 과금 방식 필요
- 리드 품질 보장 및 허위/중복 리드 방지 메커니즘 필요
- 업체 입장에서 투명한 비용 구조와 예측 가능한 지출 관리 필요

## 2. 목표 (Goals)

1. **선불 크레딧 시스템** - 모든 과금의 기반이 되는 크레딧 충전/차감 시스템 구축
2. **TossPayments 결제 연동** - 안전하고 신뢰할 수 있는 결제 인프라 구축
3. **업종별 최적화된 과금 모델** - 4가지 과금 모델로 업종 특성에 맞는 수익화
4. **투명한 비용 구조** - 업체가 비용을 예측하고 관리할 수 있는 시스템
5. **리드 품질 보장** - 허위/중복 리드 방지 및 환불 정책으로 신뢰 구축

## 3. 비범위 (Non-Goals)

- 후불 결제/외상 시스템 (선불 크레딧만 지원)
- 자동 정산/출금 (1차는 수동 정산)
- 복잡한 할인 정책 (1차는 자동충전 2% 보너스만)
- 다국어/다통화 지원 (KRW만 지원)

---

## 4. 공통 기본사항

### 4.1 선불 크레딧 정책

| 항목 | 정책 |
|------|------|
| 단위 | 1 크레딧 = 1원 |
| 충전 방식 | 선불 충전 (TossPayments) |
| 유효기간 | 충전일로부터 12개월 |
| 소멸 정책 | 유효기간 만료 시 자동 소멸, 만료 7일/1일 전 알림 |
| 환불 | 미사용 크레딧 환불 가능 (사용분 제외, 보너스 제외) |

### 4.2 충전 패키지

| 패키지 | 금액 | 보너스 | 비고 |
|--------|------|--------|------|
| 기본 | 50,000원 | - | 최소 충전 단위 |
| 스탠다드 | 100,000원 | - | - |
| 프로 | 1,000,000원 | - | - |
| 엔터프라이즈 | 3,000,000원 | - | - |
| 자동충전 | 설정금액 | +2% 보너스 | 잔액 10,000원 이하 시 자동 충전 |

### 4.3 메인 업종 (5개)

| 업종 | 과금 모델 | 비고 |
|------|----------|------|
| 의료기기 | CPL (리드 기반) | 건별 과금 |
| 간판 | CPL (리드 기반) | 건별 과금 |
| 병원마케팅 | CPL (리드 기반) | 건별 과금 |
| 인테리어 | 비딩 시스템 | 매니저 배정 + % 수수료 |
| 원외탕전/유통쇼핑몰 | CPA (회원가입형) | 리퍼럴 기반 |

### 4.4 자동 충전 정책

- **임계치**: 잔액 10,000원 이하 시 자동 충전 트리거
- **충전 금액**: 사용자 설정 (최소 50,000원)
- **보너스**: 자동충전 시 2% 보너스 크레딧 추가 지급
- **보너스 유효기간**: 본 크레딧과 동일 (12개월)
- **실패 시**: 결제 실패 알림 발송, 다음 리드 시 재시도

---

## 5. 과금 모델 1: 회원가입형 (CPA)

### 5.1 정의

- **대상 업종**: 원외탕전, 유통쇼핑몰, 한약재 유통몰
- **과금 방식**: 리퍼럴 코드를 통한 회원가입 시 성과 인정
- **과금 시점**: 회원가입 완료 시

### 5.2 정책

| 항목 | 정책 |
|------|------|
| 트래킹 방식 | 리퍼럴 코드 (URL 파라미터 `?ref=CODE`) |
| 성과 인정 | 리퍼럴 코드로 회원가입 완료 시 |
| 유효 기간 | 클릭 후 30일 이내 가입 |
| 중복 체크 | 동일 이메일/전화번호 중복 가입 불인정 |
| 트래킹 불가 시 | 쿠키 차단 등으로 추적 불가 시 성과 미인정 |

### 5.3 CPA 단가

| 업종 | 단가 | 비고 |
|------|------|------|
| 원외탕전 | 업체별 협의 | 10,000 ~ 50,000원 |
| 유통쇼핑몰 | 업체별 협의 | 5,000 ~ 30,000원 |

### 5.4 환불 정책

- 허위 가입(탈퇴, 미활동) 확인 시 크레딧 환불
- 판단 기준: 가입 후 7일 이내 탈퇴 또는 30일간 미로그인

---

## 6. 과금 모델 2: 리드 기반 (CPL)

### 6.1 건별 과금

#### 6.1.1 정의

- **대상 업종**: 의료기기, 간판, 병원마케팅
- **과금 방식**: 의사가 업체에 문의(리드) 생성 시 업체에 과금
- **과금 시점**: 리드 생성 즉시 (선불 크레딧 차감)

#### 6.1.2 리드 과금 정책 (11가지)

| # | 정책 | 설명 |
|---|------|------|
| 1 | 서비스별 단가 설정 | 업체가 제공하는 서비스별로 단가 설정 (1만원 ~ 20만원) |
| 2 | 복수 서비스 합산 | 의사가 여러 서비스 선택 시 각 서비스 단가 합산 |
| 3 | 30일 중복 무효 | 동일 의사→동일 업체 30일 내 재문의 시 무료 처리 (복구 대상) |
| 4 | 크레딧 선차감 | 리드 생성 시 즉시 크레딧 차감 |
| 5 | 잔액 부족 시 소프트 거절 | 크레딧 부족 시 리드 접수 후 충전 요청 알림 |
| 6 | 허위 리드 환불 | 연락처 오류, 장난 문의 등 확인 시 크레딧 복구 |
| 7 | 무응답 환불 | 업체 72시간 무응답 시 자동 크레딧 복구 |
| 8 | 최소 단가 | 리드당 최소 10,000원 |
| 9 | 업체별 일일 한도 | 업체가 설정한 일일 예산 초과 시 리드 수신 중단 |
| 10 | 리드 상세 비용 표시 | 의사에게 리드 발송 전 예상 비용 표시 (업체 측) |
| 11 | 정산 기간 | 리드 발생 후 7일 경과 시 확정 (환불 요청 기간) |

#### 6.1.3 서비스별 단가 예시

| 업종 | 서비스 | 단가 |
|------|--------|------|
| 의료기기 | 초음파 기기 문의 | 100,000원 |
| 의료기기 | 레이저 장비 문의 | 150,000원 |
| 간판 | 실내 간판 문의 | 30,000원 |
| 간판 | 외부 간판 문의 | 50,000원 |
| 병원마케팅 | SNS 마케팅 문의 | 50,000원 |
| 병원마케팅 | 블로그 마케팅 문의 | 30,000원 |

### 6.2 기간제 상품

#### 6.2.1 정의

- **대상**: 리드 수가 많은 업체를 위한 무제한 상품
- **과금 방식**: 기간 동안 해당 카테고리 리드 무제한 수신

#### 6.2.2 기간제 정책 (10가지)

| # | 정책 | 설명 |
|---|------|------|
| 1 | 기간 옵션 | 30일 / 60일 / 90일 / 180일 / 365일 |
| 2 | 카테고리 단위 | 특정 카테고리(서비스)에 대해 기간제 구매 |
| 3 | 무제한 리드 | 기간 내 해당 카테고리 리드 무제한 수신 |
| 4 | 중복 구매 불가 | 동일 카테고리 기간제 중복 구매 불가 |
| 5 | 기간 연장 | 만료 7일 전부터 연장 구매 가능 |
| 6 | 환불 정책 | 구매 후 7일 이내, 미사용 시 전액 환불 |
| 7 | 부분 환불 | 7일 이후 사용 비례 환불 (일할 계산) |
| 8 | 건별/기간제 병행 | 기간제 카테고리 외 건별 과금 병행 가능 |
| 9 | 만료 알림 | 만료 7일/1일 전 알림 발송 |
| 10 | 자동 갱신 | 자동 갱신 설정 시 만료일에 자동 연장 (결제 필요) |

#### 6.2.3 기간제 가격표 (예시)

| 기간 | 가격 | 일 환산 | 할인율 |
|------|------|---------|--------|
| 30일 | 500,000원 | 16,667원/일 | - |
| 60일 | 900,000원 | 15,000원/일 | 10% |
| 90일 | 1,200,000원 | 13,333원/일 | 20% |
| 180일 | 2,100,000원 | 11,667원/일 | 30% |
| 365일 | 3,650,000원 | 10,000원/일 | 40% |

---

## 7. 과금 모델 3: 비딩 시스템 (인테리어)

### 7.1 정의

- **대상 업종**: 인테리어 전용
- **과금 방식**: 프로젝트 매칭 후 계약 성사 시 수수료
- **특징**: 플랫폼 매니저가 중개, 추천 업체 3개 선정

### 7.2 비딩 프로세스

```
1. 의사가 인테리어 프로젝트 등록
   ↓
2. 플랫폼 매니저 배정 (24시간 내)
   ↓
3. 매니저가 요구사항 확인 및 업체 추천 (3개)
   ↓
4. 업체들이 견적서 제출 (입찰)
   ↓
5. 의사가 업체 선정
   ↓
6. 계약 체결
   ↓
7. 프로젝트 완료 후 수수료 정산
```

### 7.3 비딩 정책

| 항목 | 정책 |
|------|------|
| 매니저 배정 | 프로젝트 등록 후 24시간 내 자동 배정 |
| 추천 업체 수 | 최대 3개 업체 추천 |
| 입찰 기간 | 추천 후 7일 이내 |
| 수수료율 | 계약 금액의 5% (협의 가능: 3~10%) |
| 수수료 시점 | 프로젝트 완료 후 정산 |
| 최소 수수료 | 500,000원 |
| 최대 수수료 | 10,000,000원 |

### 7.4 업체 참여 조건

- 크레딧 잔액 500,000원 이상 보유
- 포트폴리오 3건 이상 등록
- 인테리어 카테고리 승인 업체

### 7.5 프로젝트 취소/환불

| 상황 | 처리 |
|------|------|
| 매니저 배정 전 취소 | 전액 환불 |
| 입찰 진행 중 취소 | 전액 환불 |
| 업체 선정 후 의사 취소 | 위약금 없음 (신뢰도 하락) |
| 계약 후 프로젝트 중단 | 진행률에 따른 수수료 정산 |

---

## 8. 과금 모델 4: 쇼핑몰

### 8.1 정의

- **대상**: 단건/소액/일회성 상품
- **과금 방식**: 일반 쇼핑몰 결제
- **예시 상품**: 의료 소모품, 진료 도서, 소프트웨어 라이선스

### 8.2 쇼핑몰 정책

| 항목 | 정책 |
|------|------|
| 결제 방식 | 크레딧 or 직접 결제 (TossPayments) |
| 배송 | 업체 직접 배송 (플랫폼 미관여) |
| 환불 | 업체별 환불 정책 적용 |
| 수수료 | 판매 금액의 10% (플랫폼 수수료) |

### 8.3 상품 등록 조건

- 승인된 업체만 상품 등록 가능
- 상품 검수 후 노출 (관리자 승인)
- 카테고리별 수수료율 차등 적용 가능

---

## 9. 업종별 과금 모델 매핑

| 업종 | 주 과금 모델 | 부 과금 모델 | 비고 |
|------|-------------|-------------|------|
| 의료기기 | CPL (건별) | 기간제 | 고단가 리드 |
| 간판 | CPL (건별) | 기간제 | 중단가 리드 |
| 병원마케팅 | CPL (건별) | 기간제 | 중단가 리드 |
| 인테리어 | 비딩 | - | 매니저 중개 |
| 원외탕전 | CPA | - | 회원가입형 |
| 유통쇼핑몰 | CPA | 쇼핑몰 | 회원가입 + 상품판매 |
| 기타 | 쇼핑몰 | - | 소액 상품 |

---

## 10. 데이터 모델 개요

### 10.1 크레딧/결제 테이블

| 테이블 | 설명 |
|--------|------|
| `credit_accounts` | 업체별 크레딧 계정 (잔액, 보너스 잔액) |
| `credit_transactions` | 크레딧 거래 내역 (충전, 차감, 복구, 만료) |
| `credit_packages` | 충전 패키지 정의 |
| `payments` | 결제 정보 (TossPayments 연동) |
| `payment_webhooks` | 결제 웹훅 로그 |

### 10.2 CPL 테이블

| 테이블 | 설명 |
|--------|------|
| `vendor_service_prices` | 업체별 서비스 단가 설정 |
| `lead_charges` | 리드별 과금 내역 |
| `vendor_subscriptions` | 기간제 구독 정보 |

### 10.3 CPA 테이블

| 테이블 | 설명 |
|--------|------|
| `referral_codes` | 리퍼럴 코드 관리 |
| `referral_signups` | 리퍼럴 회원가입 트래킹 |
| `referral_payouts` | 리퍼럴 정산 내역 |

### 10.4 비딩 테이블

| 테이블 | 설명 |
|--------|------|
| `bid_projects` | 인테리어 프로젝트 |
| `bid_responses` | 업체 입찰 응답 |
| `bid_managers` | 매니저 배정 정보 |
| `bid_contracts` | 계약 정보 |

### 10.5 쇼핑몰 테이블

| 테이블 | 설명 |
|--------|------|
| `shop_products` | 상품 정보 |
| `shop_orders` | 주문 정보 |
| `shop_order_items` | 주문 상품 |

### 10.6 정산 테이블

| 테이블 | 설명 |
|--------|------|
| `settlements` | 월별 정산 |
| `settlement_items` | 정산 상세 항목 |
| `refund_requests` | 환불 요청 |

---

## 11. API 엔드포인트 개요

### 11.1 크레딧 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/credits` | 크레딧 잔액 조회 |
| POST | `/api/credits/charge` | 크레딧 충전 (결제 준비) |
| GET | `/api/credits/transactions` | 거래 내역 조회 |
| PATCH | `/api/credits/auto-charge` | 자동 충전 설정 |

### 11.2 결제 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/payments/prepare` | 결제 준비 (TossPayments) |
| POST | `/api/payments/confirm` | 결제 승인 |
| POST | `/api/payments/webhook` | 웹훅 수신 |
| GET | `/api/payments/[id]` | 결제 상세 조회 |

### 11.3 가격 정책 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/vendors/me/prices` | 내 서비스 단가 조회 |
| POST | `/api/vendors/me/prices` | 서비스 단가 설정 |
| PATCH | `/api/vendors/me/prices/[id]` | 단가 수정 |
| DELETE | `/api/vendors/me/prices/[id]` | 단가 삭제 |

### 11.4 구독 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/vendors/me/subscriptions` | 구독 목록 조회 |
| POST | `/api/vendors/me/subscriptions` | 기간제 구매 |
| GET | `/api/vendors/me/subscriptions/[id]` | 구독 상세 |

### 11.5 리퍼럴 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/vendors/me/referrals` | 리퍼럴 코드 목록 |
| POST | `/api/vendors/me/referrals` | 리퍼럴 코드 생성 |
| GET | `/api/vendors/me/referrals/stats` | 리퍼럴 통계 |

### 11.6 비딩 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | `/api/bid/projects` | 프로젝트 등록 (의사) |
| GET | `/api/bid/projects` | 프로젝트 목록 |
| GET | `/api/bid/projects/[id]` | 프로젝트 상세 |
| POST | `/api/bid/projects/[id]/responses` | 입찰 제출 (업체) |
| PATCH | `/api/bid/projects/[id]/select` | 업체 선정 (의사) |

### 11.7 관리자 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | `/api/admin/settlements` | 정산 목록 |
| POST | `/api/admin/settlements/[id]/approve` | 정산 승인 |
| GET | `/api/admin/refunds` | 환불 요청 목록 |
| PATCH | `/api/admin/refunds/[id]` | 환불 처리 |

---

## 12. 구현 우선순위

### Phase 1: 기반 시스템

| 항목 | 우선순위 | 이유 |
|------|----------|------|
| 크레딧 시스템 | 필수 | 모든 과금의 기반 |
| TossPayments 연동 | 필수 | 결제 인프라 |
| 업체 가격 정책 | 필수 | CPL 전제 조건 |

### Phase 2: CPL (리드 과금)

| 항목 | 우선순위 | 이유 |
|------|----------|------|
| 건별 리드 과금 | 높음 | 핵심 수익 모델 |
| 기간제 상품 | 중간 | 대량 리드 업체용 |

### Phase 3: CPA/비딩/쇼핑몰

| 항목 | 우선순위 | 이유 |
|------|----------|------|
| CPA 시스템 | 중간 | 특정 업종 전용 |
| 비딩 시스템 | 중간 | 인테리어 전용 |
| 쇼핑몰 | 낮음 | 부가 수익 |

### Phase 4: 정산/환불

| 항목 | 우선순위 | 이유 |
|------|----------|------|
| 정산 관리 | 중간 | 운영 안정화 |
| 환불/보상 | 중간 | 신뢰 구축 |
| 데이터 내보내기 | 낮음 | 리포팅 |

---

## 13. 수정 필요한 기존 파일

| 파일 | 수정 내용 |
|------|----------|
| `app/src/server/lead/repository.ts` | 리드 생성 시 크레딧 차감 로직 통합 |
| `app/src/lib/schema/lead.ts` | 과금 관련 필드 추가 |
| `app/src/server/notification/service.ts` | 크레딧 부족/충전/만료 알림 |
| `app/src/app/(main)/partner/layout.tsx` | 크레딧 잔액 표시 추가 |

---

## 14. 알림 타입 추가

| 알림 타입 | 발송 조건 | 수신자 |
|----------|----------|--------|
| `credit_low` | 잔액 10,000원 이하 | 업체 |
| `credit_charged` | 충전 완료 | 업체 |
| `credit_expiring` | 만료 7일/1일 전 | 업체 |
| `credit_expired` | 크레딧 만료 | 업체 |
| `lead_charged` | 리드 과금 완료 | 업체 |
| `lead_refunded` | 리드 환불 완료 | 업체 |
| `subscription_expiring` | 구독 만료 7일/1일 전 | 업체 |
| `subscription_expired` | 구독 만료 | 업체 |
| `bid_project_assigned` | 프로젝트 배정 | 매니저 |
| `bid_vendor_recommended` | 입찰 추천 | 업체 |
| `bid_selected` | 업체 선정 | 업체 |

---

## 15. 오픈 이슈 / 결정 필요

### 15.1 결정 완료

| 항목 | 결정 | 비고 |
|------|------|------|
| 결제 연동 | TossPayments | 크레딧 + 직접 결제 동시 지원 |
| 자동 충전 임계치 | 10,000원 | 잔액 이하 시 자동 충전 |

### 15.2 결정 필요

| 항목 | 옵션 | 추천 |
|------|------|------|
| 세금계산서 발행 | TossPayments 자체 / 별도 시스템 | TossPayments 자체 |
| 비딩 수수료율 | 3~10% | 5% (기본) |
| 무응답 환불 기준 | 48시간 / 72시간 | 72시간 |
| 허위 리드 판단 기준 | 명확한 기준 필요 | 연락처 오류, 테스트 문의, 경쟁사 문의 |
| 최소 충전 금액 | 30,000원 / 50,000원 | 50,000원 |

---

## 16. 롤아웃 계획

### 16.1 1차 릴리스 (P3)

- 크레딧 시스템 (충전/차감/조회)
- TossPayments 결제 연동
- 업체 가격 정책 설정
- CPL 건별 과금 (기본 정책)

### 16.2 2차 릴리스 (P3.5)

- CPL 기간제 상품
- 자동 충전
- 중복 리드 체크/환불

### 16.3 3차 릴리스 (P4)

- CPA 시스템
- 비딩 시스템
- 쇼핑몰

### 16.4 4차 릴리스 (P5)

- 정산 관리
- 환불/보상 시스템
- 데이터 내보내기

---

## 17. 의존성 다이어그램

```
TossPayments 연동
      ↓
 크레딧 시스템 ← 모든 과금 모델 의존
      ↓
┌─────┼─────┬────────┬────────┐
│     │     │        │        │
CPL  CPA   비딩    쇼핑몰
│
├── 건별 과금
└── 기간제 상품
      ↓
   정산/환불
```
