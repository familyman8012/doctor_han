# doctor_han .claude 최적화 체크리스트

> ncos-prototype의 개선된 구조를 doctor_han에 적용하기 위한 상세 마이그레이션 가이드

---

## 1. 에이전트 마이그레이션

### 1.1 shipper.md (신규 생성)

- [ ] 파일 생성: `.claude/agents/shipper.md`

**옮길 내용 (ncos-prototype → doctor_han 조정)**:

| 항목 | ncos-prototype | doctor_han 조정 |
|------|----------------|-----------------|
| model | opus | opus |
| tools | Read, Glob, Grep, Bash, Write, Edit | 동일 |
| 검증 명령 | `pnpm lint && pnpm typecheck` | `cd app && pnpm lint && pnpm type-check` |
| Base branch | `dev` | `main` |
| PR 본문 저장 | `docs/domains/<domain>/<featurePath>/pull-request.md` | `app/doc/domains/<domain>/pull-request.md` |
| 브랜치 네이밍 | `feat/`, `fix/`, `chore/` | 동일 |

**핵심 섹션 복사**:
- [ ] 역할
- [ ] 활성화 조건
- [ ] 전제조건 (Fail-fast)
- [ ] 핵심 원칙 (5개)
- [ ] 행동 패턴 (8단계)
  - [ ] 1) Pre-flight: repo 상태 확인
  - [ ] 2) 브랜치 전략
  - [ ] 3) 검증 실행 (필수)
  - [ ] 4) 커밋 정리
  - [ ] 5) PR 타이틀 및 본문 생성
  - [ ] 6) 사용자 확인 (필수)
  - [ ] 7) Push 및 PR 생성
  - [ ] 8) 마무리
- [ ] PR 본문 템플릿 (S/M/L)

---

### 1.2 spec-writer.md (수정)

- [ ] 파일 수정: `.claude/agents/spec-writer.md`

**변경 사항**:

| 항목 | Before | After |
|------|--------|-------|
| description | "Writes and validates PRD/TSD documents" | "Writes and validates PRD documents. Does not create TSD." |
| tools | Read, Glob, Grep, Write | Read, Glob, Write, Edit |
| model | (없음) | sonnet |

**제거할 내용**:
- [ ] TSD 관련 모든 언급 제거
- [ ] DoR 판정에서 `TSD Ready: PASS/FAIL` 제거
- [ ] 참조에서 `new-tsd.md` 제거

**추가할 내용** (ncos-prototype에서 복사):
- [ ] 역할 섹션 강화: "코드/기존 구현 탐색은 planner 단계로 넘깁니다(중복 탐색 방지)"
- [ ] 핵심 원칙 4번: "중복 탐색 금지: PRD 단계에서 코드 탐색/분석을 하지 않습니다"
- [ ] 행동 패턴 1-1) 신규 vs 수정 판단 (덮어쓰기 금지 기본)
- [ ] 출력 형식(권장) 섹션

---

### 1.3 planner.md (대폭 수정)

- [ ] 파일 수정: `.claude/agents/planner.md`

**YAML 헤더 변경**:
```yaml
# Before
name: planner
description: Creates implementation plans from PRD/TSD specs. Does not write code.
tools: Read, Glob, Grep, Write

# After
name: planner
description: Creates TSD (implementation plan) from PRD. Use when planning new features or complex changes. Does not write source code.
tools: Read, Glob, Grep, Write, Edit
model: opus
skills:
  - api-generator
  - db-migration
  - zod-schema
  - service-layer
```

**추가할 섹션** (ncos-prototype에서 복사 + 경로 조정):

- [ ] 역할 섹션 강화
  - "절대 준수 사항" 문단 추가
  - "2-pass 품질 보증" 원칙 추가

- [ ] 핵심 원칙 추가
  - [ ] 5. 누락 방지(최우선): Impact Matrix 필수
  - [ ] 6. 2-pass 품질 보증

- [ ] 행동 패턴 2. 코드베이스 분석 확장
  - [ ] 2.1 탐색 스코프(누락 방지 체크리스트)
    - UI/UX 경로 조정: `app/src/app/(page)/...`
    - API 경로 조정: `app/src/app/api/...`
    - Schema 경로 조정: `app/src/lib/schema/...`
    - Server 경로 조정: `app/src/server/...`
  - [ ] 2.2 탐색 방법 (Explore-medium Tier) - 6가지 방법
  - [ ] 2.3 통합 포인트/의존성 맵 만들기
  - [ ] 2.4 Impact Matrix Audit (NO CHANGE 증명)

- [ ] 행동 패턴 3.1 계획 검토 (plan-reviewer pass) 체크리스트

- [ ] 출력 형식 템플릿 전체 교체
  - Overview 테이블
  - Write Set (변경 파일)
  - Impact Matrix (레이어별 영향)
  - Read Set (선택)
  - Requirements Summary
  - Task Chunking Rules
  - Implementation Plan
  - Step-by-Step Tasks
  - Validation Commands
  - Done When (Completion Criteria)
  - Progress Log

**경로 조정 필요**:
| ncos-prototype 경로 | doctor_han 경로 |
|---------------------|-----------------|
| `src/app/(pages)/...` | `app/src/app/(page)/...` |
| `src/app/api/...` | `app/src/app/api/...` |
| `src/lib/schema/...` | `app/src/lib/schema/...` |
| `src/server/services/...` | `app/src/server/...` |
| `src/server/db/migrations/...` | `app/supabase/migrations/...` |
| `docs/domains/<domain>/<featurePath>/tsd.md` | `app/doc/domains/<domain>/tsd.md` |

---

### 1.4 reviewer.md (대폭 수정)

- [ ] 파일 수정: `.claude/agents/reviewer.md`

**YAML 헤더 변경**:
```yaml
# Before
name: reviewer
description: Reviews code changes for quality, security, and policy compliance. Read-only.
tools: Read, Glob, Grep, Bash

# After
name: reviewer
description: Reviews code changes for quality, security, and pattern compliance. Saves a review report under app/doc/domains/<domain>/code-review.md. Does not modify source code.
tools: Read, Glob, Grep, Bash, Write, Edit
model: opus
skills:
  - api-generator
  - zod-schema
  - service-layer
```

**추가할 내용** (ncos-prototype에서 복사):

- [ ] 활성화 조건 섹션
- [ ] 핵심 원칙 추가
  - [ ] 5. 오판 방지(중요): Critical 판정 신중하게
  - [ ] 6. 신호/잡음(중요): 0건 허용

- [ ] 카테고리별 검토 섹션 확장
  - [ ] 로직 오류
  - [ ] 보안 이슈
  - [ ] 성능
  - [ ] 코드 품질

- [ ] 프로젝트 표준 검토 체크리스트 (doctor_han 패턴으로 조정)
  - withApi 미들웨어
  - guards 권한 체크
  - Zod 스키마 패턴

- [ ] 피드백 작성 섹션 전체 교체
  - [ ] 분류 기준 테이블 (Critical/Important/Suggestions/Positive)
  - [ ] 판정 상세 기준 (정확도 우선)
    - Impact/Likelihood/Detectability 축
    - Critical 기준 상세 (4가지)
    - Important 기준 상세 (5가지)
    - Suggestions 기준
  - [ ] 오판 방지 규칙
  - [ ] 무의미한 지적 방지 (Signal-to-noise)

- [ ] 출력 형식 전체 교체
  - [ ] 저장 위치 (필수): `app/doc/domains/<domain>/code-review.md`
  - [ ] 마크다운 템플릿 (Critical/Important/Suggestions/Questions/Positive/요약)

- [ ] 사용 예시 (문제 있음 / 문제 없음)

---

### 1.5 explorer.md (유지)

- [ ] 변경 없음 - 현재 상태 유지

---

## 2. 커맨드 마이그레이션

### 2.1 workflow.md (수정)

- [ ] 파일 수정: `.claude/commands/core_piv_loop/workflow.md`

**변경 사항**:

| 항목 | Before | After |
|------|--------|-------|
| Step 2 | `/prime` + `@explorer` 호출 | 직접 컨텍스트 로드 (문서만) |
| Step 3 | `/plan-feature` + `@planner` | `@planner` 직접 호출 |
| Step 4 | `/execute <plan-file>` | 메인 에이전트가 TSD 따라 실행 |
| Step 6 | `/code-review` + `@reviewer` | `@reviewer` 직접 호출 (옵션) |
| Step 7 | (없음) | `@shipper` 추가 (옵션) |

**추가할 내용** (ncos-prototype에서 복사):

- [ ] Step 1: PRD 확인 - 스코프 규칙 추가
- [ ] Step 2: 컨텍스트 로드
  - `/refresh` 권장
  - 스코프 규칙 (중요): 집중 폴더, 금지 사항
- [ ] Step 3.5: 리스크 기반 승인 판단
  - 자동 진행 조건
  - 승인 필수 조건
  - 승인 요청 형식
- [ ] Step 4: 실행 핵심 규칙
  - 순서 엄수
  - 즉시 검증
  - 계획 외 변경 금지
  - Progress Log 기록
- [ ] Step 7: PR 출하 (옵션) - @shipper 호출

- [ ] 에이전트 매핑 테이블 업데이트
- [ ] 사용자 개입 포인트 업데이트
- [ ] 참조 섹션 업데이트 (삭제된 커맨드 제거, shipper 추가)

**경로 조정**:
| ncos-prototype | doctor_han |
|----------------|------------|
| `docs/domains/$ARGUMENTS/prd.md` | `app/doc/domains/$ARGUMENTS/prd.md` |
| `docs/domains/$ARGUMENTS/tsd.md` | `app/doc/domains/$ARGUMENTS/tsd.md` |

---

### 2.2 삭제할 커맨드 (7개)

- [ ] `.claude/commands/core_piv_loop/prime.md`
- [ ] `.claude/commands/core_piv_loop/plan-feature.md`
- [ ] `.claude/commands/core_piv_loop/execute.md`
- [ ] `.claude/commands/docs/new-prd.md`
- [ ] `.claude/commands/docs/new-tsd.md`
- [ ] `.claude/commands/domain/new-api.md`
- [ ] `.claude/commands/validation/code-review.md`

### 2.3 삭제할 디렉토리 (빈 폴더)

- [ ] `.claude/commands/docs/`
- [ ] `.claude/commands/domain/`

---

## 3. 작업 순서

1. [x] **shipper.md 생성** - 신규 파일, 의존성 없음 ✅
2. [x] **spec-writer.md 수정** - TSD 관련 제거 ✅
3. [x] **planner.md 수정** - TSD 역할 추가, 가장 큰 변경 ✅
4. [x] **reviewer.md 수정** - 판정 기준 상세화 ✅
5. [x] **workflow.md 수정** - 위 에이전트들 참조 ✅
6. [x] **불필요한 커맨드 삭제** - 7개 파일 ✅
7. [x] **빈 폴더 삭제** - 2개 디렉토리 ✅

---

## 4. 검증

- [ ] `@spec-writer` 호출 → PRD만 생성, TSD 언급 없음
- [ ] `@planner` 호출 → TSD 생성 (`app/doc/domains/*/tsd.md`)
- [ ] `@reviewer` 호출 → 리뷰 리포트 저장
- [ ] `@shipper` 호출 → PR 생성 워크플로우
- [ ] `/workflow` 실행 → 전체 파이프라인 동작
- [ ] 삭제된 커맨드 호출 시 인식 안 됨

---

## 5. 참조 파일 경로

### ncos-prototype (소스)
```
/Users/julian/workspace/ncos-prototype/web/.claude/agents/shipper.md
/Users/julian/workspace/ncos-prototype/web/.claude/agents/spec-writer.md
/Users/julian/workspace/ncos-prototype/web/.claude/agents/planner.md
/Users/julian/workspace/ncos-prototype/web/.claude/agents/reviewer.md
/Users/julian/workspace/ncos-prototype/web/.claude/commands/core_piv_loop/workflow.md
```

### doctor_han (대상)
```
/Users/julian/workspace/doctor_han/.claude/agents/shipper.md (신규)
/Users/julian/workspace/doctor_han/.claude/agents/spec-writer.md
/Users/julian/workspace/doctor_han/.claude/agents/planner.md
/Users/julian/workspace/doctor_han/.claude/agents/reviewer.md
/Users/julian/workspace/doctor_han/.claude/commands/core_piv_loop/workflow.md
```
