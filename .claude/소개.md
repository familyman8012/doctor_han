# Medihub - Claude Pack 소개

이 문서는 Medihub 프로젝트에 구성된 Claude Code 설정(`.claude/`, `.agents/`)의 목적과 사용법을 설명합니다.

---

## 핵심 목표

- **드리프트 방지**: “현재 레포 사실”을 생성 문서로 고정하고, 수동 문서는 패턴/규칙에 집중합니다.
- **Fail-fast**: 스펙(DoR)·마이그레이션·생성 파일을 보호해, 추측 구현/불가역 변경을 초기에 차단합니다.
- **컨텍스트 오염 감소**: 계획/리뷰를 파일로 외부화하여 긴 작업에서도 품질을 유지합니다.

---

## 2-Layer 문서 전략

| 계층 | 위치 | 관리 방식 | 예시 |
|-----|------|---------|------|
| Manual | `.claude/reference/*.md`, `app/doc/domains/**` | 사람이 직접 작성 | 패턴, PRD/TSD |
| Generated | `.claude/reference/_generated/` | `/refresh`로 자동 생성 | 인덱스/팩트 |

갱신:
- Claude Code: `/refresh`
- CLI: `python3 .claude/scripts/refresh.py --apply`

---

## PIV 루프(Prime-Implement-Validate)

권장 진입점:

```
/workflow <domain/feature>
```

단계별:
1) `/refresh`  
2) `/prime <domain/feature>` (+ `@explorer`)  
3) `/plan-feature <domain/feature>` (+ `@planner`)  
4) `/execute <plan>`  
5) `/validate` → `/code-review` → `/commit`

---

## 스펙(SSOT) 구조 + DoR

스펙 파일 경로(권장):
- PRD: `app/doc/domains/<domain>/<feature>/prd.md`
- TSD: `app/doc/domains/<domain>/<feature>/tsd.md`

DoR(Definition of Ready) 기준:
- `.claude/reference/spec-templates.md`

DoR FAIL이면:
- `@spec-writer`가 스펙을 보강하고, PASS/FAIL + Blockers를 명시합니다.

---

## 서브 에이전트

| 에이전트 | 역할 | 도구 권한 |
|---------|------|----------|
| `@explorer` | 코드 탐색/패턴 수집 | Read-only |
| `@planner` | 구현 계획 작성 | Write(계획 파일만) |
| `@reviewer` | 변경 검토/피드백 | Read-only |
| `@spec-writer` | PRD/TSD 작성/DoR 판정 | Write(문서만) |

---

## 훅(안전장치)

`.claude/settings.local.json`의 hooks로 활성화됩니다.

- **PreToolUse**: 불가역/생성 파일 보호
  - 커밋된 Supabase 마이그레이션 수정 금지
  - `_generated` 직접 편집 금지
  - `database.types.ts` 직접 편집 금지(항상 `pnpm db:gen`)
- **PostToolUse**: `eslint --fix`를 “가능할 때만” 자동 적용(실패해도 작업 차단 없음)

---

## 테스트 전략(운영 원칙)

- Vitest 인프라는 열어두되, 테스트 작성은 리스크 기반(권한/정합성/비즈니스 로직 중심)으로 결정합니다.
- 테스트 파일이 없는 레포 상태에서도 개발 흐름을 막지 않도록 `--passWithNoTests`로 유지합니다.

